<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

     <!-- Bootstrap CSS -->
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <title>06 - Cours SQL - Exercice - BDD Immobilier</title>

    <link rel="stylesheet" href="css/styles.css">
</head>
    <body>
        <header class="container mb-4 bg-white">
            <div class="row">
                <div class="col-12">
                    <h1 class="display-1 text-primary text-center text-decoration-underline">06 - Cours SQL - Exercice Immobilier(#6)</h1>
                    <p class="lead text-center text-danger">Immobilier</p>
                </div>
            </div>
            <!-- fin row  -->
        </header>

        <section class="container mb-4 bg-light">
            <h2>Modélisation de la BDD immobilier</h2>
            <p><code>CREATE DATABASE immobilier CHARACTER SET 'utf8';</code></p>
            <div class="row border border-primary">
                <div class="col-md-6">
                    <h3 class="alert alert-success">Table de logement</h3>
                    <figure>
                        <img src="img/Table Logement.jpg" alt="table logement">
                        <figcaption>Logement</figcaption>
                    </figure>
                </div>
                <div class="col-md-6">
                    <h3>Commande SQL - Table Logement</h3>
                    <ul>
                        <li>création de la table "logement" : <br>
                        <code>CREATE TABLE IF NOT EXISTS logement ( <br>
                         idLogement int(6) NOT NULL AUTO_INCREMENT,  <br> 
                         type varchar(100) NOT NULL, <br>
                         ville varchar(100) NOT NULL, <br>
                         budget int(7) NOT NULL, <br>
                         superficie int(5) NOT NULL, <br>
                         categorie varchar(100) NOT NULL, <br>
                         PRIMARY KEY (idLogement) <br>
                        ) ENGINE=InnoDB DEFAULT CHARSET=latin1;</code></li>
                    </ul>
                </div>
    
            </div>
            <!-- fin row -->
            <div class="row">
                <div class="col-md-6">
                    <h3>Table demande</h3>
                    <figure>
                        <img src="img/Table Demande.jpg" alt="table demande">
                        <figcaption>demande</figcaption>
                    </figure>
                </div>
                <div class="col-md-6">
                    <h3>Commande SQL</h3>
                    <ul>
                        <li>création de la table "demande" : <br>
                        <code>CREATE TABLE IF NOT EXISTS demande ( <br>
                        idDemande int(5) NOT NULL AUTO_INCREMENT,  <br>
                        idPersone int(3) NOT NULL AUTO_INCREMENT, <br>
                        type varchar(100) NOT NULL, <br>
                        ville varchar(100) NOT NULL, <br>
                        budget int(7) NOT NULL, <br>
                        superficie int(5) NOT NULL, <br>
                        categorie varchar(100) NOT NULL, <br>
                        PRIMARY KEY (idDemande) <br>
                        ) ENGINE=InnoDB DEFAULT CHARSET=latin1;</code></li>
                    </ul>
                </div>
            </div>
            <!-- fin row 2 -->
            <div class="row border border-danger">
                <div class="col-md-6">
                    <h3 class="alert alert-success">Table agence</h3>
                    <figure>
                        <img src="img/agence.jpg" alt="table agence">
                        <figcaption>agence</figcaption>
                    </figure>
                </div>
                <div class="col-md-6">
                    <h3>Commande SQL</h3>
                    <ul>
                        <li>création de la table "agence" : <br>
                            <code>CREATE TABLE IF NOT EXISTS agence ( <br>
                             idAgence int(6) NOT NULL AUTO_INCREMENT,  <br> 
                             nom varchar(100) NOT NULL, <br>
                             adresse varchar(100) NOT NULL, <br>
                             PRIMARY KEY (idAgence) <br>
                            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;</code></li>
                    </ul>
                </div>
            </div>
            <!-- fin row 3 -->
            <div class="row">
                <div class="col-md-6">
                    <h3>Table logement_agence</h3>
                    <figure>
                        <img src="img/logement_agence.jpg" alt="table logement_agence">
                        <figcaption>logement_agence</figcaption>
                    </figure>
                </div>
                <div class="col-md-6">
                    <h3>Commande SQL</h3>
                    <ul>
                        <li>création de la table "logement_agence" : </li>
                    </ul>
                </div> 
            </div>
            <!-- fin row 5 -->
            <div class="row border border-danger">
                <div class="col-md-6">
                    <h3 class="alert alert-success">Table logement_personne</h3>
                    <figure>
                        <img src="img/Table logement_personne.jpg" alt="table logement_personne">
                        <figcaption>logement_personne</figcaption>
                    </figure>
                </div>
                <div class="col-md-6">
                    <h3>Commande SQL</h3>
                    <ul>
                        <li>création de la table "logement_personne" : </li>
                    </ul>
                </div> 
            </div>
            <!-- fin row 6 -->
            <div class="row">
                <div class="col-md-6">
                    <h3>Table personne</h3>
                    <figure>
                        <img src="img/Table Personne.jpg" alt="personne">
                        <figcaption>personne</figcaption>
                    </figure>
                </div>
                <div class="col-md-6">
                    <h3>Commande SQL</h3>
                    <ul>
                        <li>création de la table "personne" : <br>
                            <code>CREATE TABLE IF NOT EXISTS agence ( <br>
                             idAgence int(6) NOT NULL AUTO_INCREMENT,  <br> 
                             prenom varchar(100) NOT NULL, <br>
                             PRIMARY KEY (idPersone) <br>
                            ) ENGINE=InnoDB DEFAULT CHARSET=latin1;</code></li>
                    </ul>
                </div>
            </div>
            <figure>
                <img style="width: 1000px;" src="img/clef etranger 2.PNG" alt="clef etranger 2">
                <figcaption>clef etrangére des tables</figcaption>
            </figure>

            <divrow class="">
                <div>
                    <h3> Exercices</h3>
                    <ul>
                        <li>Affichez le nom des agences : <code>SELECT nom FROM agence ORDER BY nom DESC</code> </li>
                        <li>Affichez le numéro de l'agence « Orpi » : <code>SELECT idAgence FROM agence WHERE nom ='orpi'</code></li>
                        <li>Affichez le premier enregistrement de la table logement : <code>SELECT * FROM logement WHERE idLogement=(SELECT MIN(idLogement) FROM logement)</code></li>
                        <li>Affichez le premier enregistrement de la table logement :<code>SELECT * FROM logement ORDER BY idLogement LIMIT 0,1</code></li>
                        <li>Affichez le premier enregistrement de la table logement :<code>SELECT * FROM logement ORDER BY idLogement LIMIT 0,1</code></li>
                        <li>Affichez le premier enregistrement de la table logement :<code></code></li>
                        <li>Affichez le nombre de logements (Alias : Nombre_de_logements) :<code>SELECT COUNT(*) AS nombre_de_logement FROM logement;</code></li>
                        <li> Affichez le nombre de logements (Alias : Nombre_de_logements) :<code>SELECT  COUNT(idLogement) AS "nombre de logement" FROM logement
                        </code></li>
                        <li>Affichez les logements à vendre à moins de 150 000 € dans l'ordre croissant des prix:<code>SELECT * FROM logement WHERE prix < 150000 AND categorie ='vente' ORDER BY prix ASC</code></li>
                        <li>Afficher le nombre de logements à la location (alias : 'nombre_logement_en_location'):<code>SELECT COUNT(idLogement) AS 'nombre logement location' FROM logement WHERE categorie = 'location'</code></li>
                        <li>Afficher les villes différentes recherchées par les personnes demandeuses d'un logement :<code>SELECT DISTINCT ville FROM demande</code></li>
                        <li>Affichez le nombre de biens à vendre par ville : (Alias  nbr_logement_envente_ville)<code>SELECT ville, COUNT(ville) as 'nbr_logement_envente_ville' FROM logement WHERE categorie='vente' GROUP BY ville ASC</code></li>
                        <li> <code>SELECT COUNT(idLogement)AS 'nbr logement', ville 
                            FROM logement 
                            WHERE ville IN (SELECT DISTINCT(ville) FROM logement)
                            AND categorie='vente'
                            GROUP BY ville
                            </code></li>
                        <li>Quels sont les id des logements destinés à la location ?<code>SELECT idLogement FROM logement WHERE categorie='location' ORDER BY idLogement </code></li>
                        <li>Quels sont les id des logements entre 20 et 30m²?:<code>SELECT idLogement FROM logement WHERE superficie BETWEEN '20' AND '30'</code></li>
                        <li>Quels sont les id des logements entre 20 et 30m²?:<code>SELECT *
                            FROM logement
                            WHERE superficie>= 20 AND superficie<=30; </code></li>
                        <li>Quel est le prix vendeur(hors commission) du logement le moins cher à vendre?<code>SELECT * 
                            FROM logement 
                            WHERE categorie = 'vente' 
                            ORDER BY prix 
                            ASC LIMIT 0,1</code></li>
                        <li>Quel est le prix vendeur(hors commission) du logement le moins cher à vendre? :<code>SELECT MIN(prix), idLogement, categorie
                            FROM logement 
                            WHERE categorie = 'vente'</code></li>
                        <li>Dans quelle ville se trouvent les maisons à vendre ?<code>SELECT DISTINCT(ville)
                            FROM logement 
                            WHERE genre='maison' 
                            AND categorie ='vente'</code></li>
                        <li> <code>SELECT ville 
                            FROM logement 
                            WHERE categorie = 'vente' 
                            AND genre = 'appartement' 
                            GROUP By ville</code>
                        </li>
                        <li>L'agence Orpi souhaite diminuer les frais qu'elle applique sur le logement ayant l'id « 5246 ». Passer les frais de ce logement de 800 à 730€<code></code></li>
                        <li>L'agence Orpi souhaite diminuer les frais qu'elle applique sur le logement ayant l'id « 5246 ». Passer les frais de ce logement de 800 à 730€<<code>UPDATE logement_agence 
                            SET frais ='1200000' 
                            WHERE idLogement = '5246' 
                            AND idAgence = (SELECT idAgence FROM agence WHERE nom ='orpi')</code>
                        </li>
                        <li>Quels sont les logements gérés par l'agence « laforet »<code>SELECT idLogement FROM logement_agence WHERE idAgence=(SELECT idAgence FROM agence WHERE nom = 'laforet')</code></li>
                        <li>Quels sont les logements gérés par l'agence « laforet » <code>SELECT * 
                            FROM logement_agence 
                            WHERE idAgence =
                            (SELECT idAgence 
                            FROM agence 
                            WHERE nom = 'laforet')</code>
                        </li>
                        <li>Affichez le nombre de propriétaires dans la ville de Paris (Alias : Nombre propriétaire parisien)<code>SELECT COUNT(idLogement) AS 'nbr proprio' FROM logement WHERE ville='paris'</code></li>
                        <li>Affichez le nombre de propriétaires dans la ville de Paris (Alias : Nombre propriétaire parisien) <code>SELECT COUNT(DISTINCT(logement_personne.idPersonne))
                            AS 'nombre de proprietaires parisiens'
                            FROM logement_personne , logement
                            WHERE logement_personne.idLogement = logement.idLogement
                            AND logement.ville='paris'</code>
                        </li>
                        <li>Afficher les infos des trois premières personnes souhaitant acheter un logement<code>SELECT * 
                            FROM personne, demande 
                            WHERE personne.idPersonne = demande.idPersonne 
                            AND demande.categorie = 'vente' 
                            ORDER BY demande.idDemande 
                            LIMIT 0,3</code>
                        </li>
                        <li>Requête de jointure: Afficher le prénom du vendeur du '5770'<code>SELECT personne.prenom, logement_personne.idLogement, logement.ville, logement.superficie, logement.genre, agence.nom
                            FROM personne, logement_personne, logement, agence, logement_agence
                            WHERE personne.idPersonne = logement_personne.idPersonne
                            AND logement_personne.idLogement = logement.idLogement
                            AND logement_personne.idLogement = logement_agence.idLogement
                            AND agence.idAgence = logement_agence.idAgence
                            AND logement_personne.idLogement = 5770</code>
                        </li>

                        <li>Requête de jointure: Afficher le prénom du vendeur du '5770': avec 3 tables<code>SELECT personne.prenom, logement_personne.idLogement, logement.ville, logement.genre
                            FROM personne, logement_personne, logement
                            WHERE personne.idPersonne = logement_personne.idPersonne
                            AND logement.idLogement = logement_personne.idLogement
                            AND logement_personne.idLogement = 5770</code>
                        </li>

                        <li>Affichez les prénoms des personnes souhaitant avoir un logement à Lyon<code>SELECT personne.prenom, demande.ville
                            FROM personne, demande
                            WHERE personne.idPersonne = demande.idPersonne
                            AND demande.ville = 'lyon'</code>
                        </li>
                        <li>Affichez les prénoms des personnes souhaitant accéder à un logement en location à Paris<code>SELECT personne.prenom , demande.ville ,demande.categorie 
                            FROM personne ,demande 
                            WHERE personne.idPersonne = demande.idPersonne 
                            AND demande.ville = 'Paris' 
                            AND demande.categorie = 'location';</code>
                        </li>
                        <li>Affichez les prénoms des personnes souhaitant acheter un logement de la plus grande à la plus petite superficie<code>SELECT personne.prenom, personne.idPersonne, demande.superficie
                            FROM personne, demande
                            WHERE personne.idPersonne = demande.idPersonne
                            AND demande.categorie = 'vente'
                            ORDER BY demande.superficie DESC</code>
                        </li>
                        <li>Quel sont les prix finaux proposés par les agences pour la maison à la vente ayant la référence « 5091 » ? (Alias :  frais d'agence inclus)<code>SELECT agence.nom, (logement_agence.frais+logement.prix)
                            AS 'prix finaux' 
                            FROM agence, logement_agence, logement
                            WHERE agence.idAgence = logement_agence.idAgence
                            AND logement_agence.idLogement = logement.idLogement
                            AND logement_agence.idLogement = '5091'</code>
                        </li>

                        <li>Quel sont les prix finaux proposés par les agences pour la maison à la vente ayant la référence « 5091 » ? (Alias :  frais d'agence inclus)<code>SELECT (logement.prix + logement_agence.frais) <br>
                            AS 'prix_final', logement.prix, logement.categorie <br>
                            FROM logement, logement_agence <br>
                            WHERE logement_agence.idLogement = logement.idLogement <br>
                            AND logement_agence.idLogement = '5091'</code> <br></code>
                        </li>

                        <li>Quel sont les prix finaux proposés par les agences pour la maison à la vente ayant la référence « 5091 » ? (Alias :  frais d'agence inclus)<code>SELECT (logement.prix + logement_agence.frais) 
                            AS 'Prix Finaux', logement.categorie, logement.ville, logement.prix, logement_agence.frais
                            FROM logement, logement_agence
                            WHERE logement.idLogement = logement_agence.idLogement
                            AND logement_agence.idLogement = '5091'</code></li>

                        <li>Indiquez les frais ajoutés par l'agence pour le logement ID 5873<code>SELECT logement_agence.frais
                            FROM logement_agence, logement
                            WHERE logement_agence.idLogement = logement.idLogement
                            AND logement_agence.idLogement = '5873'</code>
                        </li>   
                        
                        <li>Si l’ensemble des logements étaient vendus ou loués demain, quel serait le bénéfice généré grâce aux frais d’agence et pour chaque agence
                            (Alias : benefice, classement : par ordre croissant des gains) // tables agence et logement_agence // SUM() // GROUP BY et ORDER<code>SELECT agence.nom, SUM(logement_agence.frais) AS 'benefice'
                                FROM agence, logement_agence
                                WHERE agence.idAgence = logement_agence.idAgence
                                GROUP BY agence.idAgence
                                ORDER BY benefice ASC</code>
                        </li>
                        
                        <li>Affichez les id des biens en location, les prix, suivis des frais d’agence (classement : dans l’ordre croissant des prix)<code></code></li>
                    </ul>
                </div>
            </div>
        </section>


    <!-- Optional JavaScript -->
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
    crossorigin="anonymous"></script>
    </body>
</html>